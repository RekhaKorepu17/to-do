<div class="container">
  <h1>My TO-DO List</h1>

  <!-- Add New Task Form -->
  <div class="form-container">
    <%= form_with model: @task, local: true, class: "task-form" do |form| %>
      <div class="form-input-group">
        <%= form.text_field :title, 
            placeholder: "Add a new task...", 
            class: "task-input" %>
        <% if @task.errors[:title].any? %>
          <p class="error-message"><%= @task.errors[:title].first %></p>
        <% end %>
      </div>
      <%= form.submit "Add Task", class: "btn btn-primary" %>
    <% end %>
  </div>

  <!-- Grouped Task List -->
  <div class="task-list">
    <% if @tasks_grouped.any? %>
      <% @tasks_grouped.each do |month_year, tasks| %>
        <div class="task-group">
          <h2 class="task-group-heading"><%= month_year %></h2>

          <% tasks.each do |task| %>
            <div class="task-item">
              <div class="task-content">
                <%= link_to task_path(task), class: "task-title #{'completed' if task.completed?}" do %>
                  <%= task.title %>
                <% end %>

                <% if task.completed? %>
                  <span class="badge completed-badge">Completed</span>
                <% end %>
              </div>

              <div class="task-actions">
                <%= link_to "Edit", edit_task_path(task), class: "btn btn-edit" %>
                <%= button_to "Delete", task_path(task), 
                      method: :delete,
                      data: { confirm: "Are you sure?" },
                      class: "btn btn-delete",
                      form: { style: "display: inline;" } %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <div class="empty-state">
        <p>No tasks yet. Add your first task above!</p>
      </div>
    <% end %>
  </div>

  <!-- Task Summary -->
  <% total = @tasks_grouped.values.flatten %>
  <% if total.any? %>
    <div class="task-summary">
      <p>
        Total: <%= total.count %> tasks | 
        Completed: <%= total.count(&:completed?) %> | 
        Pending: <%= total.count { |t| !t.completed? } %>
      </p>
    </div>
  <% end %>
</div>
